From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Damien Caliste <dcaliste@free.fr>
Date: Tue, 8 Oct 2024 16:59:57 +0200
Subject: [PATCH] Fallback to sso credential plugin.

Change-Id: Ie4237908bdc69cb681f6cee830876a4d60dd1641
---
 .../qmfmessageserver/qmailcredentials.cpp         | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/src/libraries/qmfmessageserver/qmailcredentials.cpp b/src/libraries/qmfmessageserver/qmailcredentials.cpp
index 88f2f81d..d83b2cd5 100644
--- a/src/libraries/qmfmessageserver/qmailcredentials.cpp
+++ b/src/libraries/qmfmessageserver/qmailcredentials.cpp
@@ -191,14 +191,13 @@ QMailCredentialsInterface *QMailCredentialsFactory::getServiceForAccount(const Q
     const QMailAccountConfiguration::ServiceConfiguration &auth = config.serviceConfiguration(QLatin1String("auth"));
     if (auth.id().isValid()) {
         const QString plugin = auth.value(QLatin1String("plugin"));
-        if (!plugin.isEmpty()) {
-            credentials = QMailCredentialsFactory::createService(plugin, parent);
-            if (!credentials) {
-                qMailLog(Messaging) << "Credential plugin" << plugin
-                                    << "is not available for account id: "
-                                    << config.id()
-                                    << ", account configuration will be used";
-            }
+        credentials = QMailCredentialsFactory::createService
+            (plugin.isEmpty() ? QLatin1String("sso") : plugin, parent);
+        if (!credentials) {
+            qMailLog(Messaging) << "Credential plugin" << plugin
+                                << "is not available for account id: "
+                                << config.id()
+                                << ", account configuration will be used";
         }
     }
     if (!credentials) {
