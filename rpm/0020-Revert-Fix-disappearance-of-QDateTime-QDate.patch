From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Damien Caliste <dcaliste@free.fr>
Date: Wed, 19 May 2021 09:19:24 +0200
Subject: [PATCH] Revert "Fix disappearance of QDateTime(QDate)"

This reverts commit a8db671f00ebf5aa56e57d1bdf1511d9af22c809.
---
 .../tst_qmail_listmodels.cpp                  |  8 ++---
 .../tst_qmail_sortkeys/tst_qmail_sortkeys.cpp | 20 ++++++------
 .../tst_qmaildisconnected.cpp                 | 20 ++++++------
 .../tst_qmailmessageset.cpp                   | 20 ++++++------
 .../tst_qmailserviceaction.cpp                | 20 ++++++------
 .../tst_qmailstorageaction.cpp                | 32 +++++++++----------
 tests/tst_qmailstore/tst_qmailstore.cpp       |  4 +--
 .../tst_qmailstorekeys/tst_qmailstorekeys.cpp | 24 +++++++-------
 tests/tst_qmailthread/tst_qmailthread.cpp     | 20 ++++++------
 .../tst_storagemanager/tst_storagemanager.cpp | 16 +++++-----
 10 files changed, 92 insertions(+), 92 deletions(-)

diff --git a/tests/tst_qmail_listmodels/tst_qmail_listmodels.cpp b/tests/tst_qmail_listmodels/tst_qmail_listmodels.cpp
index aaa4e1d0..75322222 100644
--- a/tests/tst_qmail_listmodels/tst_qmail_listmodels.cpp
+++ b/tests/tst_qmail_listmodels/tst_qmail_listmodels.cpp
@@ -139,8 +139,8 @@ void tst_QMail_ListModels::initTestCase()
     msg1.setFrom(QMailAddress("0404404040"));
     msg1.setTo(QMailAddress("0404040404"));
     msg1.setSubject("Where are you?");
-    msg1.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg1.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg1.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg1.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg1.setStatus(QMailMessage::Incoming, true);
     msg1.setStatus(QMailMessage::New, false);
     msg1.setStatus(QMailMessage::Read, true);
@@ -158,8 +158,8 @@ void tst_QMail_ListModels::initTestCase()
     msg2.setTo(QMailAddress("old@example.org"));
     msg2.setCc(QMailAddressList() << QMailAddress("anotherguy@example.org"));
     msg2.setSubject("email message test");
-    msg2.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg2.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg2.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg2.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg2.setStatus(QMailMessage::Incoming, true);
     msg2.setStatus(QMailMessage::New, true);
     msg2.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmail_sortkeys/tst_qmail_sortkeys.cpp b/tests/tst_qmail_sortkeys/tst_qmail_sortkeys.cpp
index 7dd59785..42208d58 100644
--- a/tests/tst_qmail_sortkeys/tst_qmail_sortkeys.cpp
+++ b/tests/tst_qmail_sortkeys/tst_qmail_sortkeys.cpp
@@ -261,8 +261,8 @@ void tst_QMail_SortKeys::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -285,8 +285,8 @@ void tst_QMail_SortKeys::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -309,8 +309,8 @@ void tst_QMail_SortKeys::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -338,8 +338,8 @@ void tst_QMail_SortKeys::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -365,8 +365,8 @@ void tst_QMail_SortKeys::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmaildisconnected/tst_qmaildisconnected.cpp b/tests/tst_qmaildisconnected/tst_qmaildisconnected.cpp
index f3467d6d..28688772 100644
--- a/tests/tst_qmaildisconnected/tst_qmaildisconnected.cpp
+++ b/tests/tst_qmaildisconnected/tst_qmaildisconnected.cpp
@@ -260,8 +260,8 @@ void tst_QMailDisconnected::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -284,8 +284,8 @@ void tst_QMailDisconnected::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -308,8 +308,8 @@ void tst_QMailDisconnected::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -337,8 +337,8 @@ void tst_QMailDisconnected::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -364,8 +364,8 @@ void tst_QMailDisconnected::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmailmessageset/tst_qmailmessageset.cpp b/tests/tst_qmailmessageset/tst_qmailmessageset.cpp
index ff0e029d..01d10c52 100644
--- a/tests/tst_qmailmessageset/tst_qmailmessageset.cpp
+++ b/tests/tst_qmailmessageset/tst_qmailmessageset.cpp
@@ -267,8 +267,8 @@ void tst_QMailMessageSet::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -291,8 +291,8 @@ void tst_QMailMessageSet::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -315,8 +315,8 @@ void tst_QMailMessageSet::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -344,8 +344,8 @@ void tst_QMailMessageSet::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -371,8 +371,8 @@ void tst_QMailMessageSet::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmailserviceaction/tst_qmailserviceaction.cpp b/tests/tst_qmailserviceaction/tst_qmailserviceaction.cpp
index c9b73126..0a0d2ceb 100644
--- a/tests/tst_qmailserviceaction/tst_qmailserviceaction.cpp
+++ b/tests/tst_qmailserviceaction/tst_qmailserviceaction.cpp
@@ -265,8 +265,8 @@ void tst_QMailServiceAction::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -289,8 +289,8 @@ void tst_QMailServiceAction::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -313,8 +313,8 @@ void tst_QMailServiceAction::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -342,8 +342,8 @@ void tst_QMailServiceAction::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -369,8 +369,8 @@ void tst_QMailServiceAction::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmailstorageaction/tst_qmailstorageaction.cpp b/tests/tst_qmailstorageaction/tst_qmailstorageaction.cpp
index e90402e2..6f690e83 100644
--- a/tests/tst_qmailstorageaction/tst_qmailstorageaction.cpp
+++ b/tests/tst_qmailstorageaction/tst_qmailstorageaction.cpp
@@ -338,8 +338,8 @@ void tst_QMailStorageAction::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -362,8 +362,8 @@ void tst_QMailStorageAction::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -386,8 +386,8 @@ void tst_QMailStorageAction::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -415,8 +415,8 @@ void tst_QMailStorageAction::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -442,8 +442,8 @@ void tst_QMailStorageAction::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
@@ -487,8 +487,8 @@ void tst_QMailStorageAction::test_storageaction_add()
     message.setFrom(QMailAddress("wilma@example.net"));
     message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
     message.setSubject("Simple test message");
-    message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-100).startOfDay()));
-    message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-100).startOfDay()));
+    message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-100))));
+    message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-100))));
     message.setStatus(QMailMessage::Incoming, true);
     message.setStatus(QMailMessage::New, false);
     message.setStatus(QMailMessage::Read, false);
@@ -739,8 +739,8 @@ void tst_QMailStorageAction::test_storageaction_rollBackUpdates()
     message.setFrom(QMailAddress("barney@example.net"));
     message.setTo(QMailAddressList() << QMailAddress("account3@example.org") << QMailAddress("testing@test"));
     message.setSubject("Rollback test message");
-    message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-98).startOfDay()));
-    message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-98).startOfDay()));
+    message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-98))));
+    message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-98))));
     message.setStatus(QMailMessage::Incoming, true);
     message.setStatus(QMailMessage::New, false);
     message.setStatus(QMailMessage::Read, false);
@@ -836,8 +836,8 @@ void tst_QMailStorageAction::test_storageaction_discardMessages()
     message.setFrom(QMailAddress("barney@example.net"));
     message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
     message.setSubject("Another test message");
-    message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-99).startOfDay()));
-    message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-99).startOfDay()));
+    message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-99))));
+    message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-99))));
     message.setStatus(QMailMessage::Incoming, true);
     message.setStatus(QMailMessage::New, false);
     message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmailstore/tst_qmailstore.cpp b/tests/tst_qmailstore/tst_qmailstore.cpp
index 8d552ba7..deec061a 100644
--- a/tests/tst_qmailstore/tst_qmailstore.cpp
+++ b/tests/tst_qmailstore/tst_qmailstore.cpp
@@ -1773,8 +1773,8 @@ void tst_QMailStore::message()
     msg2.setParentAccountId(account2.id());
     msg2.setParentFolderId(QMailFolder::LocalStorageFolderId);
     msg2.setSubject("email message test");
-    msg2.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg2.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg2.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg2.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg2.setStatus(QMailMessage::Incoming, true);
     msg2.setStatus(QMailMessage::New, true);
     msg2.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_qmailstorekeys/tst_qmailstorekeys.cpp b/tests/tst_qmailstorekeys/tst_qmailstorekeys.cpp
index f92689d8..6648d2e5 100644
--- a/tests/tst_qmailstorekeys/tst_qmailstorekeys.cpp
+++ b/tests/tst_qmailstorekeys/tst_qmailstorekeys.cpp
@@ -339,8 +339,8 @@ void tst_QMailStoreKeys::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -363,8 +363,8 @@ void tst_QMailStoreKeys::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -387,8 +387,8 @@ void tst_QMailStoreKeys::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -416,8 +416,8 @@ void tst_QMailStoreKeys::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -443,8 +443,8 @@ void tst_QMailStoreKeys::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
@@ -1627,7 +1627,7 @@ void tst_QMailStoreKeys::messageSubject()
 
 void tst_QMailStoreKeys::messageTimeStamp()
 {
-    QDateTime today(QDate::currentDate().startOfDay()), yesterday(QDate::currentDate().addDays(-1).startOfDay()), lastWeek(QDate::currentDate().addDays(-7).startOfDay());
+    QDateTime today(QDate::currentDate()), yesterday(QDate::currentDate().addDays(-1)), lastWeek(QDate::currentDate().addDays(-7));
     today = today.toUTC();
     yesterday = yesterday.toUTC();
     lastWeek = lastWeek.toUTC();
@@ -1687,7 +1687,7 @@ void tst_QMailStoreKeys::messageTimeStamp()
 
 void tst_QMailStoreKeys::messageReceptionTimeStamp()
 {
-    QDateTime today(QDate::currentDate().startOfDay()), yesterday(QDate::currentDate().addDays(-1).startOfDay()), lastWeek(QDate::currentDate().addDays(-7).startOfDay());
+    QDateTime today(QDate::currentDate()), yesterday(QDate::currentDate().addDays(-1)), lastWeek(QDate::currentDate().addDays(-7));
     today = today.toUTC();
     yesterday = yesterday.toUTC();
     lastWeek = lastWeek.toUTC();
diff --git a/tests/tst_qmailthread/tst_qmailthread.cpp b/tests/tst_qmailthread/tst_qmailthread.cpp
index 504257e0..e7b8104d 100644
--- a/tests/tst_qmailthread/tst_qmailthread.cpp
+++ b/tests/tst_qmailthread/tst_qmailthread.cpp
@@ -284,8 +284,8 @@ void tst_qmailthread::initTestCase()
         message.setFrom(QMailAddress("0404404040"));
         message.setTo(QMailAddress("0404040404"));
         message.setSubject("Where are you?");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, true);
@@ -308,8 +308,8 @@ void tst_qmailthread::initTestCase()
         message.setFrom(QMailAddress("account2@example.org"));
         message.setTo(QMailAddress("account1@example.org"));
         message.setSubject("inboxMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, false);
@@ -332,8 +332,8 @@ void tst_qmailthread::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("fred@example.net"));
         message.setSubject("archivedMessage1");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-1).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-1))));
         message.setStatus(QMailMessage::Outgoing, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Sent, true);
@@ -361,8 +361,8 @@ void tst_qmailthread::initTestCase()
         message.setFrom(QMailAddress("account1@example.org"));
         message.setTo(QMailAddress("account2@example.org"));
         message.setSubject("Fwd:inboxMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, true);
         message.setStatus(QMailMessage::Read, true);
@@ -388,8 +388,8 @@ void tst_qmailthread::initTestCase()
         message.setFrom(QMailAddress("fred@example.net"));
         message.setTo(QMailAddressList() << QMailAddress("account2@example.org") << QMailAddress("testing@test"));
         message.setSubject("Re:savedMessage2");
-        message.setDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
-        message.setReceivedDate(QMailTimeStamp(QDate::currentDate().addDays(-7).startOfDay()));
+        message.setDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
+        message.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate().addDays(-7))));
         message.setStatus(QMailMessage::Incoming, true);
         message.setStatus(QMailMessage::New, false);
         message.setStatus(QMailMessage::Read, false);
diff --git a/tests/tst_storagemanager/tst_storagemanager.cpp b/tests/tst_storagemanager/tst_storagemanager.cpp
index 8724db84..3b4ea8dd 100644
--- a/tests/tst_storagemanager/tst_storagemanager.cpp
+++ b/tests/tst_storagemanager/tst_storagemanager.cpp
@@ -154,8 +154,8 @@ void tst_StorageManager::initTestCase()
     msg1.setFrom(QMailAddress("0404404040"));
     msg1.setTo(QMailAddress("0404040404"));
     msg1.setSubject("Where are you?");
-    msg1.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg1.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg1.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg1.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg1.setStatus(QMailMessage::Incoming, true);
     msg1.setStatus(QMailMessage::New, false);
     msg1.setStatus(QMailMessage::Read, true);
@@ -173,8 +173,8 @@ void tst_StorageManager::initTestCase()
     msg2.setTo(QMailAddress("old@example.org"));
     msg2.setCc(QMailAddressList() << QMailAddress("anotherguy@example.org"));
     msg2.setSubject("email message test");
-    msg2.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg2.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg2.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg2.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg2.setStatus(QMailMessage::Incoming, true);
     msg2.setStatus(QMailMessage::New, true);
     msg2.setStatus(QMailMessage::Read, false);
@@ -213,8 +213,8 @@ void tst_StorageManager::test_add()
     msg3.setTo(QMailAddress("old@example.org"));
     msg3.setCc(QMailAddressList() << QMailAddress("anotherguy@example.org"));
     msg3.setSubject("email message test");
-    msg3.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg3.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg3.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg3.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg3.setStatus(QMailMessage::Incoming, true);
     msg3.setStatus(QMailMessage::New, true);
     msg3.setStatus(QMailMessage::Read, false);
@@ -237,8 +237,8 @@ void tst_StorageManager::test_remove()
     msg4.setTo(QMailAddress("old@example.org"));
     msg4.setCc(QMailAddressList() << QMailAddress("anotherguy@example.org"));
     msg4.setSubject("email message test");
-    msg4.setDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
-    msg4.setReceivedDate(QMailTimeStamp(QDate::currentDate().startOfDay()));
+    msg4.setDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
+    msg4.setReceivedDate(QMailTimeStamp(QDateTime(QDate::currentDate())));
     msg4.setStatus(QMailMessage::Incoming, true);
     msg4.setStatus(QMailMessage::New, true);
     msg4.setStatus(QMailMessage::Read, false);
